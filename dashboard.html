<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EmotionMonitor Neon Dashboard</title>
<style>
  body {
    background: linear-gradient(120deg, #0b0b0b, #1a1a1a);
    color: white;
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    margin: 0;
    height: 100vh;
    overflow: hidden;
  }
  h1 {
    font-size: 26px;
    margin-top: 25px;
    text-shadow: 0 0 25px #00ffc3, 0 0 10px #00ffc3;
  }
  .stats {
    font-size: 16px;
    margin: 10px;
    color: #d3d3d3;
  }
  .chart-container {
    position: relative;
    width: 90vw;
    height: 65vh;
    margin: auto;
    border-radius: 16px;
    box-shadow: 0 0 25px rgba(0,255,200,0.5);
    background: rgba(20, 20, 20, 0.9);
    backdrop-filter: blur(10px);
    overflow: hidden;
  }
  canvas {
    width: 100% !important;
    height: 100% !important;
  }
  @keyframes glowPulse {
    0% { box-shadow: 0 0 15px rgba(0,255,200,0.3); }
    50% { box-shadow: 0 0 30px rgba(0,255,200,0.6); }
    100% { box-shadow: 0 0 15px rgba(0,255,200,0.3); }
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>ðŸ§  EmotionMonitor Neon Dashboard</h1>
  <div class="stats" id="statsText">Loading...</div>
  <div class="chart-container" id="chartGlow">
    <canvas id="emotionChart"></canvas>
  </div>

<script>
const ctx = document.getElementById('emotionChart').getContext('2d');
const glow = document.getElementById('chartGlow');
let chart;
let gradientShift = 0;

const emotionColors = {
  "Focused": { border: "#00ffcc", fill: "rgba(0,255,200,0.25)", glow: "#00ffcc" },
  "Normal": { border: "#ffea00", fill: "rgba(255,234,0,0.25)", glow: "#ffea00" },
  "Tired": { border: "#1e90ff", fill: "rgba(30,144,255,0.25)", glow: "#1e90ff" },
  "Stressed": { border: "#ff1744", fill: "rgba(255,23,68,0.25)", glow: "#ff1744" },
  "Idle": { border: "#888", fill: "rgba(136,136,136,0.25)", glow: "#888" }
};

// Animated gradient generator
function gradient(ctx, color) {
  gradientShift = (gradientShift + 0.01) % 1;
  const g = ctx.createLinearGradient(0, 0, 0, 400);
  g.addColorStop(0, color);
  g.addColorStop(gradientShift, 'rgba(255,255,255,0.1)');
  g.addColorStop(1, 'rgba(0,0,0,0)');
  return g;
}

chart = new Chart(ctx, {
  type: 'line',
  data: { labels: [], datasets: [{
    label: 'Keystrokes per minute',
    data: [],
    borderWidth: 3,
    fill: true,
    borderColor: "#00ffcc",
    backgroundColor: gradient(ctx, "rgba(0,255,200,0.25)"),
    tension: 0.4,
    pointRadius: 0,
  }] },
  options: {
    animation: { duration: 800, easing: "easeInOutQuad" },
    scales: {
      x: { ticks: { color: "#ccc" }, grid: { color: "rgba(255,255,255,0.05)" } },
      y: { ticks: { color: "#ccc" }, grid: { color: "rgba(255,255,255,0.08)" } }
    },
    plugins: { legend: { labels: { color: "#fff" } } }
  }
});

async function update() {
  try {
    const res = await fetch("/api/stats");
    const data = await res.json();

    if (!data.labels.length) return;

    const emotion = data.current.emotion;
    const colors = emotionColors[emotion] || emotionColors["Idle"];

    // Neon glow animation
    glow.style.animation = `glowPulse 3s infinite`;
    glow.style.boxShadow = `0 0 30px ${colors.glow}`;

    chart.data.labels = data.labels;
    chart.data.datasets[0].data = data.values;
    chart.data.datasets[0].borderColor = colors.border;
    chart.data.datasets[0].backgroundColor = gradient(ctx, colors.fill);
    chart.update();

    document.getElementById("statsText").innerHTML =
      `Emotion: <b style="color:${colors.border}">${emotion}</b> | 
      KPM: ${data.current.kpm} | Mouse: ${data.current.mouse} | Clicks: ${data.current.clicks}`;
  } catch (err) { console.error(err); }
}

// Update and pulse every 10 seconds
setInterval(update, 10000);
update();

// Animate gradient every frame
setInterval(() => {
  const currentColor = chart.data.datasets[0].borderColor || "#00ffcc";
  chart.data.datasets[0].backgroundColor = gradient(ctx, currentColor);
  chart.update('none');
}, 120);
</script>
</body>
</html>
